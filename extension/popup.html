<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <title>Pensieve</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --color-bg: #0f1115;
      --color-surface: #1b1f27;
      --color-surface-alt: #242a35;
      --color-border: #2e3744;
      --color-border-accent: #3b82f6;
      --color-text: #e5e7eb;
      --color-text-dim: #9ca3af;
      --color-primary: #3b82f6;
      --color-primary-accent: #60a5fa;
      --color-danger: #ef4444;
      --color-success: #10b981;
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-full: 999px;
      --grad-accent: linear-gradient(135deg,#3b82f6,#6366f1 60%,#8b5cf6);
      --shadow-sm: 0 1px 2px rgba(0,0,0,.4),0 0 0 1px rgba(255,255,255,0.02) inset;
      --shadow-md: 0 4px 12px -2px rgba(0,0,0,.5),0 0 0 1px rgba(255,255,255,0.04) inset;
      font-synthesis: none;
    }
    html[data-theme='light'] {
      --color-bg: #f5f7fb;
      --color-surface: #ffffff;
      --color-surface-alt: #f1f5f9;
      --color-border: #dbe2ec;
      --color-border-accent: #3b82f6;
      --color-text: #111827;
      --color-text-dim: #4b5563;
      --shadow-sm: 0 1px 2px rgba(0,0,0,.08),0 0 0 1px rgba(0,0,0,0.03) inset;
      --shadow-md: 0 4px 14px -2px rgba(0,0,0,.12),0 0 0 1px rgba(0,0,0,0.04) inset;
    }
    * { box-sizing: border-box; }
    body { 
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif; 
      margin: 0; 
      min-width: 310px; 
      max-width: 360px;
      background: var(--color-bg); 
      color: var(--color-text);
      -webkit-font-smoothing: antialiased;
      padding: 14px 14px 18px;
    }
    h1 { 
      font-size: 15px; 
      font-weight: 600; 
      margin: 0 0 12px; 
      letter-spacing: .5px; 
      display: flex; 
      align-items: center; 
      gap: 6px; 
      background: var(--grad-accent); 
      -webkit-background-clip: text; 
      background-clip: text; 
      color: transparent; 
    }
    h1 svg { flex: 0 0 18px; }
    .card { 
      background: var(--color-surface); 
      border: 1px solid var(--color-border); 
      border-radius: var(--radius-md); 
      padding: 14px 14px 16px; 
      box-shadow: var(--shadow-sm); 
      position: relative;
      overflow: hidden;
    }
    .card:before { 
      content: ""; 
      position: absolute; 
      inset: 0; 
      pointer-events: none; 
      background: radial-gradient(circle at 120% -20%,rgba(99,102,241,0.25),transparent 60%);
      mix-blend-mode: overlay;
    }
    .section + .section { margin-top: 14px; }
    .muted { color: var(--color-text-dim); font-size: 12px; }
    #userInfo { font-size: 12px; margin: 8px 0 4px; font-weight: 500; }
    .buttons { display: flex; flex-direction: column; gap: 8px; }
    button { 
      cursor: pointer; 
      border: 1px solid var(--color-border); 
      background: var(--color-surface-alt); 
      color: var(--color-text); 
      padding: 8px 12px; 
      border-radius: var(--radius-sm); 
      font-size: 13px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      gap: 6px; 
      font-weight: 500; 
      letter-spacing: .3px; 
      transition: background .2s,border-color .2s,transform .15s; 
      position: relative; 
      overflow: hidden;
    }
    button:not(:disabled):hover { background: var(--color-surface-alt); border-color: var(--color-primary-accent); }
    button:active { transform: translateY(1px); }
    button.primary { 
      background: var(--grad-accent); 
      border-color: var(--color-border-accent); 
      color: #fff; 
      box-shadow: var(--shadow-sm);
    }
    button.primary:not(:disabled):hover { filter: brightness(1.05); }
    button.danger { border-color: var(--color-danger); color: var(--color-danger); background: rgba(239,68,68,0.06); }
    button.danger:not(:disabled):hover { background: rgba(239,68,68,0.12); }
    button:disabled { cursor: not-allowed; opacity: .55; }
    .icon { width: 16px; height: 16px; display: inline-flex; }
    #status { font-size: 12px; margin-top: 10px; min-height: 16px; line-height: 1.35; }
    #status.error { color: var(--color-danger); }
    #status.success { color: var(--color-success); }
    .hidden { display: none !important; }
    .divider { height: 1px; background: var(--color-border); margin: 10px 0 8px; }
    #memoriesList { margin-top: 10px; list-style: none; padding: 0; max-height: 160px; overflow-y: auto; font-size: 12px; }
    #memoriesList li { 
      padding: 6px 8px; 
      background: var(--color-surface-alt); 
      border: 1px solid var(--color-border); 
      border-radius: var(--radius-sm); 
      margin-bottom: 6px; 
      line-height: 1.3; 
      position: relative; 
      animation: fadeIn .35s ease; 
      word-break: break-word;
    }
    #memoriesList li:last-child { margin-bottom: 0; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
    .spinner { 
      width: 16px; height: 16px; border: 3px solid rgba(255,255,255,0.18); 
      border-top-color: #fff; border-radius: 50%; animation: spin .65s linear infinite; 
      display: inline-block; vertical-align: middle; 
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .status-row { display: flex; align-items: center; gap: 6px; }
    .top-bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
    .theme-toggle { background: var(--color-surface-alt); width: 34px; height: 30px; border-radius: var(--radius-sm); }
    .theme-toggle svg { stroke: currentColor; }
    .gradient-border { position: relative; }
  .gradient-border:before { content: ""; position: absolute; inset: 0; padding: 1px; border-radius: inherit; background: linear-gradient(140deg,#3b82f6,#6366f1,#8b5cf6); -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none; opacity: .75; }
    /* Scrollbar styling (WebKit) */
    #memoriesList::-webkit-scrollbar { width: 8px; }
    #memoriesList::-webkit-scrollbar-track { background: var(--color-surface); }
    #memoriesList::-webkit-scrollbar-thumb { background: var(--color-border); border-radius: 4px; }
    #memoriesList::-webkit-scrollbar-thumb:hover { background: var(--color-primary); }
    footer { margin-top: 12px; text-align: center; font-size: 10px; color: var(--color-text-dim); }
    a { color: var(--color-primary); text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1 title="Pensieve Extension">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 20h9"/><path d="M12 4h9"/><rect x="3" y="9" width="4" height="6" rx="1"/><path d="M7 12h4"/><rect x="15" y="9" width="4" height="6" rx="1"/><path d="M11 12h4"/></svg>
      Pensieve
    </h1>
    <button id="themeToggle" class="theme-toggle" title="Toggle theme" aria-label="Toggle theme">
      <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2"/><path d="M12 21v2"/><path d="M4.22 4.22l1.42 1.42"/><path d="M18.36 18.36l1.42 1.42"/><path d="M1 12h2"/><path d="M21 12h2"/><path d="M4.22 19.78l1.42-1.42"/><path d="M18.36 5.64l1.42-1.42"/></svg>
    </button>
  </div>

  <div class="card gradient-border" id="rootCard">
    <div class="section" id="authSection">
      <div id="authActions" class="buttons">
        <button id="loginBtn" class="primary" autofocus>
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 3h4a2 2 0 012 2v4M9 21H5a2 2 0 01-2-2v-4M21 9l-7.5 7.5M21 9h-6M21 9v6" /></svg>
          Sign in with Microsoft
        </button>
        <button id="logoutBtn" class="danger hidden">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7"/><path stroke-linecap="round" stroke-linejoin="round" d="M7 4H4a1 1 0 00-1 1v14a1 1 0 001 1h3"/></svg>
          Sign out
        </button>
        <div id="userInfo" class="hidden"></div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="section" id="appSection">
      <div id="appActions" class="buttons hidden">
        <button id="retrieveMemoriesBtn" class="primary" title="Retrieve relevant memories for current ChatGPT messages">
          <span class="btn-label">Retrieve memories</span>
        </button>
      </div>
      <ul id="memoriesList" aria-live="polite" aria-label="Retrieved memories" class="hidden"></ul>
    </div>

    <div id="status" class="muted" role="status" aria-live="polite">Please sign in to continue</div>
  </div>

  <footer>
    <span>v<span id="extVersion">1.0.0</span> â€¢ <a href="https://github.com/srwshkrshnn" target="_blank" rel="noopener noreferrer">Project</a></span>
  </footer>

  <script type="module" src="popup.js"></script>
</body>
</html>
